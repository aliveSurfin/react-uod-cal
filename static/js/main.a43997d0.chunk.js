(this["webpackJsonpreact-uod-cal"]=this["webpackJsonpreact-uod-cal"]||[]).push([[0],{26:function(e,t,a){e.exports=a(47)},31:function(e,t,a){},36:function(e,t,a){},37:function(e,t,a){},38:function(e,t,a){},47:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),s=a(3),o=a.n(s),i=(a(31),a(9)),l=a.n(i),c=a(14),u=a(19),p=a(20),d=a(25),m=a(24),h=a(15),f=a(7),v=a.n(f);a(36),a(37),a(38);function w(){return r.a.createElement("div",{class:"lds-ellipsis"},r.a.createElement("div",null),r.a.createElement("div",null),r.a.createElement("div",null),r.a.createElement("div",null))}v.a.locale("en",{week:{dow:1,doy:1}});var g=Object(h.b)(v.a),k=a(39)({domain:"github.com/aliveSurfin/react-uod-cal",name:"react-uod-cal",prodId:{company:"github.com/aliveSurfin",product:"react-uod-cal"}}),y=!1;function b(e){for(var t=e.event,a="https://www.dundee.ac.uk/module/"+t.modcode,n=[],s=0;s<t.staff.length;s++)n.push(r.a.createElement("a",{href:t.staff[s].url}," ",t.staff[s].name," "));return r.a.createElement("div",{className:"event-wrapper"},r.a.createElement("div",{className:"event-type"},t.type),r.a.createElement("div",{className:"event-module"},r.a.createElement("a",{href:a},t.modcode," ",t.moduleName)),r.a.createElement("div",{className:"event-room"},"&nbsp;"===t.room?"n/a":t.room),r.a.createElement("div",{className:"event-staff"},n))}var E=function(e){Object(d.a)(a,e);var t=Object(m.a)(a);function a(e){var n;Object(u.a)(this,a),n=t.call(this,e);var r=new Date;r.setHours(8,0,0);var s=new Date;return s.setHours(20,0,0),n.state={minTime:r,maxTime:s,loading:!1,events:[],modules:[]},n}return Object(p.a)(a,[{key:"openUrl",value:function(){if(""===this.state.matric||void 0===this.state.matric||null===this.state.matric)return!1;window.open(window.location.origin+window.location.pathname+"/?s="+this.state.matric,"_self")}},{key:"_HandleInput",value:function(e){"Enter"===e.key&&(console.log("hit"),this.openUrl())}},{key:"_HandleChange",value:function(e){console.log(e),this.setState({matric:e})}},{key:"render",value:function(){var e=this,t={agenda:{event:b}};return r.a.createElement("div",{id:"container"},y&&r.a.createElement("a",{className:"ical-dl",download:"cal.ics",href:y},"Download iCal"),this.state.loading&&r.a.createElement(w,null),r.a.createElement(h.a,{components:t,localizer:g,events:null==this.state.calendar?[]:this.state.calendar,startAccessor:"start",endAccessor:"end",style:null==this.state.calendar?{display:"none"}:{height:700},defaultView:"agenda",min:this.state.minTime,max:this.state.maxTime,formats:{agendaHeaderFormat:function(e){var t=e.start,a=e.end;return v.a.utc(t).format("DD/MM/YYYY")+" - "+v.a.utc(a).format("DD/MM/YYYY")}}}),null==this.state.calendar&&!this.state.loading&&r.a.createElement("div",{className:"matric-input"},r.a.createElement("form",null,r.a.createElement("label",null," Enter Matriculation Number "),r.a.createElement("input",{onChange:function(t){return e._HandleChange(t.target.value)},onKeyDown:function(t){return e._HandleInput(t)},name:"matriculation"}),r.a.createElement("button",{onClick:function(){return e.openUrl()},type:"submit"},"Go"))))}},{key:"tableToJson",value:function(e){var t=[];if(console.log(e),void 0==e.rows[0])return{};for(var a=[],n=0;n<e.rows[0].cells.length;n++)a[n]=e.rows[0].cells[n].innerHTML.toLowerCase().replace(/ /gi,"");for(var r=1;r<e.rows.length;r++){for(var s=e.rows[r],o={},i=0;i<s.cells.length;i++)o[a[i]]=s.cells[i].innerHTML;t.push(o)}return t}},{key:"parseTimetable",value:function(){var e=Object(c.a)(l.a.mark((function e(t){var a,n,r,s,o,i,c,u,p,d,m,h,f,v,w,g,b,E,T,S,M,x,D,H,C,I,N,O,U,j;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(o=function(e,t){var a=new Date(e);return a.setDate(a.getDate()+t),a},s=function(e){var t=e.split(":"),a=[];return a.push(parseInt(t[0].trim())),a.push(parseInt(t[1].trim())),a},r=function(e){if(e.includes("-")){for(var t=e.split("-"),a=[],n=parseInt(t[0].trim());n<=parseInt(t[1].trim());n++)a.push(parseInt(n));return a}var r=[];return r.push(parseInt(e.trim())),r},n=function(e,t){return new Date(e.getTime()+6e4*t)},a=[],i=new Date(2021,8,27),c=new Date(2021,0,18),u={},p=0;p<t.length;p++)for(d=p,m=0;m<t[p].length;m++){if(h=t[p][m],(f=h.activity.split(" ")[0]).includes("/")?f=f.split("/")[0]:f.includes("-")&&(f=f.split("-")[0]),f=f.replace(/[^0-9a-z]/gi,""),"https://www.dundee.ac.uk/module/",f in u||(u[f]=this.getModuleInfo("https://www.dundee.ac.uk/module/"+f)),v=u[f],w=[],h.weeks.includes("-")&&h.weeks.includes(","))for(g=h.weeks.split(","),b=0;b<g.length;b++)w=w.concat(r(g[b]));else if(h.weeks.includes(","))for(E=h.weeks.split(","),T=0;T<E.length;T++)w=w.concat(r(E[T]));else w=(h.weeks.includes("-"),w.concat(r(h.weeks)));for(S=0;S<w.length;S++){for(M=void 0,w[S]>=12?(w[S]=w[S]-12,M=o(c,7*w[S])):M=o(i,7*(w[S]-1)),M=o(M,d),x=s(h.start),D=n(M,60*x[0]),D=n(D,x[1]),H=s(h.end),C=n(M,60*H[0]),C=n(C,H[1]),"https://www.dundee.ac.uk/people/",(I=h.staff.split(",")).length%2!==0&&I.shift(),N=[],O=0;O<I.length;O+=2)N.push({name:I[O+1].trim()+" "+I[O].trim(),url:"https://www.dundee.ac.uk/people/"+I[O+1].trim()+"-"+I[O].trim()});U={title:h.type+" | "+v,type:h.type,start:D,end:C,allDay:!1,moduleName:v,modcode:f,room:h.room,activity:h.activity,staff:N,duration:h.duration},j={start:D,end:C,summary:U.type+" : "+v,description:U.activity,location:U.room},k.createEvent(j),a.push(U)}}return y=k.toURL(),e.abrupt("return",a);case 11:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getModuleInfo",value:function(e){var t=new XMLHttpRequest;return t.open("GET","https://secret-chamber-30285.herokuapp.com/"+e,!1),t.send(),t.responseText.split("<title>")[1].split("module")[0].trim()}},{key:"getTimetable",value:function(e){if(""!==e&&void 0!==e&&null!==e){"https://mysterious-everglades-22580.herokuapp.com/","https://cors-spooky.herokuapp.com/","https://secret-chamber-30285.herokuapp.com/";var t="https://timetable.dundee.ac.uk:8085/reporting/textspreadsheet?objectclass=student+set&idtype=id&identifier="+e+"/1&t=SWSCUST+student+set+textspreadsheet&days=1-7&weeks=1-52&periods=1-28&template=SWSCUST+student+set+textspreadsheet",a=new XMLHttpRequest;a.open("GET","https://secret-chamber-30285.herokuapp.com/"+t,!1),a.send();var n=a.responseText;if(void 0!==(n=n.split("<p><span class='labelone'>Monday</span></p>")[1])){for(var r=(n=n.split("<p><span class='labelone'>Saturday</span></p>")[0]).split("</span></p>"),s=[],o=0;o<r.length;o++){r[o].includes("<p><span class='labelone'")&&(r[o]=r[o].split("</table>")[0]);var i=(new DOMParser).parseFromString(r[o],"text/html");s.push(this.tableToJson(i.body.firstChild))}var l=this.parseTimetable(s);this.setState({calendar:l})}}}},{key:"getTimetableFromMatric",value:function(e){}},{key:"createURLFromMatric",value:function(e){return"https://mysterious-everglades-22580.herokuapp.com/","https://cors-spooky.herokuapp.com/","https://secret-chamber-30285.herokuapp.com/","https://secret-chamber-30285.herokuapp.com/https://timetable.dundee.ac.uk:8085/reporting/textspreadsheet?objectclass=student+set&idtype=id&identifier="+e+"/1&t=SWSCUST+student+set+textspreadsheet&days=1-7&weeks=1-52&periods=1-28&template=SWSCUST+student+set+textspreadsheet"}},{key:"rawHtmlToJSON",value:function(){var e=Object(c.a)(l.a.mark((function e(t){var a,n,r,s,o;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==(t=t.split("<p><span class='labelone'>Monday</span></p>")[1])){e.next=3;break}return e.abrupt("return");case 3:for(t=t.split("<p><span class='labelone'>Saturday</span></p>")[0],a=t.split("</span></p>"),console.log(a),n=[],r=0;r<a.length;r++)a[r].includes("<p><span class='labelone'")&&(a[r]=a[r].split("</table>")[0]),s=new DOMParser,o=s.parseFromString(a[r],"text/html"),n.push(this.tableToJson(o.body.firstChild));return e.abrupt("return",n);case 9:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"componentDidMount",value:function(){var e=this;console.log(window.location.search);var t=window.location.search.split("=")[1];if(/[0-9]{9}/.test(t)){this.setState({loading:!0});var a=new XMLHttpRequest;a.open("GET",this.createURLFromMatric(t)),a.send(),a.onload=function(){e.rawHtmlToJSON(a.responseText).then((function(t){e.parseTimetable(t).then((function(t){e.setState({calendar:t,loading:!1})}))}))}}else this.setState({loading:!1})}}]),a}(n.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(E,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[26,1,2]]]);
//# sourceMappingURL=main.a43997d0.chunk.js.map