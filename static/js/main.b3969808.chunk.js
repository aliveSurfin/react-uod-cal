(this["webpackJsonpreact-uod-cal"]=this["webpackJsonpreact-uod-cal"]||[]).push([[0],{26:function(e,t,a){e.exports=a(47)},31:function(e,t,a){},36:function(e,t,a){},37:function(e,t,a){},38:function(e,t,a){},47:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),s=a(3),o=a.n(s),i=(a(31),a(9)),l=a.n(i),c=a(14),u=a(19),d=a(20),m=a(25),p=a(24),h=a(15),f=a(7),v=a.n(f);a(36),a(37),a(38);function w(){return r.a.createElement("div",{className:"lds-ellipsis"},r.a.createElement("div",null),r.a.createElement("div",null),r.a.createElement("div",null),r.a.createElement("div",null))}v.a.locale("en",{week:{dow:1,doy:1}});var g=Object(h.b)(v.a),b=a(39)({domain:"github.com/aliveSurfin/react-uod-cal",name:"react-uod-cal",prodId:{company:"github.com/aliveSurfin",product:"react-uod-cal"}}),y=!1;function k(e){for(var t=e.event,a="https://www.dundee.ac.uk/module/"+t.modcode,n=[],s=0;s<t.staff.length;s++)n.push(r.a.createElement("a",{href:t.staff[s].url}," ",t.staff[s].name," "));return r.a.createElement("div",{className:"event-wrapper"},r.a.createElement("div",{className:"event-type"},t.type),r.a.createElement("div",{className:"event-module"},r.a.createElement("a",{href:a},t.modcode," ",t.moduleName)),r.a.createElement("div",{className:"event-room"},"&nbsp;"===t.room?"n/a":t.room),r.a.createElement("div",{className:"event-staff"},n))}var E=function(e){Object(m.a)(a,e);var t=Object(p.a)(a);function a(e){var n;Object(u.a)(this,a),n=t.call(this,e);var r=new Date;r.setHours(8,0,0);var s=new Date;return s.setHours(20,0,0),n.state={minTime:r,maxTime:s,loading:!1,events:[],modules:[]},n}return Object(d.a)(a,[{key:"openUrl",value:function(){if(""===this.state.matric||void 0===this.state.matric||null===this.state.matric)return!1;window.open(window.location.origin+window.location.pathname+"/?s="+this.state.matric,"_self")}},{key:"_HandleInput",value:function(e){"Enter"===e.key&&(console.log("hit"),this.openUrl())}},{key:"_HandleChange",value:function(e){console.log(e),this.setState({matric:e})}},{key:"render",value:function(){var e=this,t={agenda:{event:k}};return r.a.createElement("div",{id:"container"},y&&r.a.createElement("a",{className:"ical-dl",download:"cal.ics",href:y},"Download iCal"),this.state.loading&&r.a.createElement(w,null),r.a.createElement(h.a,{components:t,localizer:g,events:null==this.state.calendar?[]:this.state.calendar,startAccessor:"start",endAccessor:"end",style:null==this.state.calendar?{display:"none"}:{height:700},defaultView:"agenda",min:this.state.minTime,max:this.state.maxTime,formats:{agendaHeaderFormat:function(e){var t=e.start,a=e.end;return v.a.utc(t).format("DD/MM/YYYY")+" - "+v.a.utc(a).format("DD/MM/YYYY")}}}),null==this.state.calendar&&!this.state.loading&&r.a.createElement("div",{className:"matric-input"},r.a.createElement("form",null,r.a.createElement("label",null," Enter Matriculation Number "),r.a.createElement("div",{id:"matricContainer"},r.a.createElement("input",{onChange:function(t){return e._HandleChange(t.target.value)},onKeyDown:function(t){return e._HandleInput(t)},name:"matriculation"}),r.a.createElement("select",{id:"slash",name:"slash"},r.a.createElement("option",{value:1},"/1"),r.a.createElement("option",{value:2},"/2"))),r.a.createElement("button",{type:"submit"},"Go"))))}},{key:"tableToJson",value:function(e){var t=[];if(void 0==e.rows[0])return{};for(var a=[],n=0;n<e.rows[0].cells.length;n++)a[n]=e.rows[0].cells[n].innerHTML.toLowerCase().replace(/ /gi,"");for(var r=1;r<e.rows.length;r++){for(var s=e.rows[r],o={},i=0;i<s.cells.length;i++)o[a[i]]=s.cells[i].innerHTML;t.push(o)}return t}},{key:"parseTimetable",value:function(){var e=Object(c.a)(l.a.mark((function e(t){var a,n,r,s,o,i,c,u,d,m,p,h,f,v,w,g,k,E,S,T,D,M,x,H,N,I,C,O,L,U;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=function(e,t){var a=new Date(e);return a.setDate(a.getDate()+t),a},s=function(e){var t=e.split(":"),a=[];return a.push(parseInt(t[0].trim())),a.push(parseInt(t[1].trim())),a},r=function(e){if(e.includes("-")){for(var t=e.split("-"),a=[],n=parseInt(t[0].trim());n<=parseInt(t[1].trim());n++)a.push(parseInt(n));return a}var r=[];return r.push(parseInt(e.trim())),r},n=function(e,t){return new Date(e.getTime()+6e4*t)},a=[],i=new Date(2021,8,27),c=new Date(2022,0,17),u={},t){e.next=10;break}return e.abrupt("return");case 10:for(d=0;d<t.length;d++)for(m=d,p=0;p<t[d].length;p++){if(h=t[d][p],(f=h.activity.split(" ")[0]).includes("/")?f=f.split("/")[0]:f.includes("-")&&(f=f.split("-")[0]),f=f.replace(/[^0-9a-z]/gi,""),"https://www.dundee.ac.uk/module/",f in u||(u[f]=this.getModuleInfo("https://www.dundee.ac.uk/module/"+f)),v=u[f],w=[],h.weeks.includes("-")&&h.weeks.includes(","))for(g=h.weeks.split(","),k=0;k<g.length;k++)w=w.concat(r(g[k]));else if(h.weeks.includes(","))for(E=h.weeks.split(","),S=0;S<E.length;S++)w=w.concat(r(E[S]));else w=(h.weeks.includes("-"),w.concat(r(h.weeks)));for(T=0;T<w.length;T++){for(D=void 0,w[T]>=12?(w[T]=w[T]-12,D=o(c,7*(w[T]-1))):D=o(i,7*(w[T]-1)),D=o(D,m),M=s(h.start),x=n(D,60*M[0]),x=n(x,M[1]),H=s(h.end),N=n(D,60*H[0]),N=n(N,H[1]),"https://www.dundee.ac.uk/people/",(I=h.staff.split(",")).length%2!==0&&I.shift(),C=[],O=0;O<I.length;O+=2)C.push({name:I[O+1].trim()+" "+I[O].trim(),url:"https://www.dundee.ac.uk/people/"+I[O+1].trim()+"-"+I[O].trim()});L={title:h.type+" | "+v,type:h.type,start:x,end:N,allDay:!1,moduleName:v,modcode:f,room:h.room,activity:h.activity,staff:C,duration:h.duration},U={start:x,end:N,summary:L.type+" : "+v,description:L.activity,location:L.room},b.createEvent(U),a.push(L)}}return y=b.toURL(),e.abrupt("return",a);case 13:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getModuleInfo",value:function(e){var t=new XMLHttpRequest;return t.open("GET","https://secret-chamber-30285.herokuapp.com/"+e,!1),t.send(),t.responseText.split("<title>")[1].split("module")[0].trim()}},{key:"createURLFromMatric",value:function(e,t){var a="https://secret-chamber-30285.herokuapp.com/https://timetable.dundee.ac.uk:8085/reporting/textspreadsheet?objectclass=student+set&idtype=id&identifier="+e+"/".concat(t)+"&t=SWSCUST+student+set+textspreadsheet&days=1-7&weeks=1-52&periods=1-28&template=SWSCUST+student+set+textspreadsheet";return console.log(a),a}},{key:"rawHtmlToJSON",value:function(){var e=Object(c.a)(l.a.mark((function e(t){var a,n,r,s,o;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==(t=t.split("<p><span class='labelone'>Monday</span></p>")[1])){e.next=3;break}return e.abrupt("return");case 3:for(t=t.split("<p><span class='labelone'>Saturday</span></p>")[0],a=t.split("</span></p>"),n=[],r=0;r<a.length;r++)a[r].includes("<p><span class='labelone'")&&(a[r]=a[r].split("</table>")[0]),s=new DOMParser,o=s.parseFromString(a[r],"text/html"),n.push(this.tableToJson(o.body.firstChild));return e.abrupt("return",n);case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"componentDidMount",value:function(){var e=this,t=new URLSearchParams(window.location.search),a=t.get("matriculation"),n=t.get("slash");if(n=null===n?1:n,/[0-9]{9}/.test(a)||/[0-9]{7}/.test(a)){this.setState({loading:!0});var r=new XMLHttpRequest;r.open("GET",this.createURLFromMatric(a,n)),r.send(),r.onload=function(){return 400==r.status?(alert("Unable to get timetable for ".concat(a,"/").concat(n)),void e.setState({loading:!1})):503==r.status?(alert("Timetable servers down"),void e.setState({loading:!1})):void e.rawHtmlToJSON(r.responseText).then((function(t){e.parseTimetable(t).then((function(t){e.setState({calendar:t,loading:!1})}))}))}}else this.setState({loading:!1})}}]),a}(n.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(E,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[26,1,2]]]);
//# sourceMappingURL=main.b3969808.chunk.js.map